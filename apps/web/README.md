# @anon/web

Next.js frontend for the AnonPool privacy system.

## Overview

This is the web interface for AnonPool, providing:

- **Privacy Wallet**: Connect wallet, deposit/withdraw tokens anonymously
- **Auction UI**: Place anonymous bids in slot-based auctions
- **Proof Generation**: Client-side and server-side ZK proof generation
- **Proof Freshness Alerts**: Warnings when proofs need regeneration

## Getting Started

### Prerequisites

- [Bun](https://bun.sh/) - JavaScript runtime
- Running local environment or deployed contracts

### Development

```bash
# Start with local Anvil environment
cd ../.. && ./scripts/local-dev.sh

# In another terminal, start the dev server
bun run dev
```

Open [http://localhost:3000](http://localhost:3000) to view the app.

### Environment Variables

Create `.env.local` (auto-generated by `local-dev.sh`):

```env
# Network mode
NEXT_PUBLIC_TESTNET=true

# Contract addresses
NEXT_PUBLIC_POOL_CONTRACT=0x...
NEXT_PUBLIC_AUCTION_CONTRACT=0x...

# RPC URLs
NEXT_PUBLIC_TESTNET_RPC_URL=http://127.0.0.1:8545

# API Keys (optional)
NEYNAR_API_KEY=
NEYNAR_SIGNER_UUID=
UPLOAD_API_KEY=
```

## Project Structure

```
src/
├── app/                    # Next.js App Router
│   ├── page.tsx            # Home page
│   ├── layout.tsx          # Root layout with providers
│   └── api/
│       └── prove/
│           └── withdraw/   # Server-side proof generation API
│               └── route.ts
│
├── components/             # React components
│   ├── header.tsx          # Navigation header
│   ├── auction/            # Auction UI components
│   ├── deposit/            # Deposit modal
│   ├── withdraw/           # Withdraw modal with proof mode selection
│   └── ui/                 # Shared UI components (shadcn/ui)
│
├── hooks/                  # React hooks
│   ├── use-deposit.ts      # Deposit flow hook
│   ├── use-withdraw.ts     # Withdraw flow hook
│   ├── use-proof-mode.ts   # Proof mode preference (client/server)
│   └── use-token-price.ts  # Token price fetching
│
├── providers/              # Context providers
│   └── privacy-wallet.tsx  # Privacy wallet state management
│
├── config/                 # App configuration
│   └── env.ts              # Environment variable access
│
└── lib/                    # Utilities
    └── utils.ts            # Helper functions
```

## Key Features

### Privacy Wallet

The privacy wallet manages:
- Note derivation from wallet signature
- Balance tracking across confirmed deposits
- Proof generation for withdrawals
- Chain synchronization

```tsx
import { usePrivacyWallet } from '@/providers/privacy-wallet'

function MyComponent() {
  const { isUnlocked, balance, unlock, prepareWithdraw } = usePrivacyWallet()

  // Unlock wallet (requires signature)
  await unlock()

  // Check balance
  console.log('Available:', balance.available)

  // Prepare a withdrawal
  const proof = await prepareWithdraw(amount, recipientAddress)
}
```

### Proof Mode Selection

Users can choose between:
- **Fast (Server)**: ~7s proof generation using native `bb` CLI
- **Slow (Client)**: ~70s proof generation using WASM in browser

```tsx
import { useProofMode } from '@/hooks/use-proof-mode'

function ProofModeSelector() {
  const { mode, setMode } = useProofMode()

  return (
    <select value={mode} onChange={e => setMode(e.target.value)}>
      <option value="server">Fast (Server)</option>
      <option value="client">Slow (Client)</option>
    </select>
  )
}
```

### Server-Side Proof Generation

The `/api/prove/withdraw` endpoint provides fast proof generation:

```typescript
// POST /api/prove/withdraw
const response = await fetch('/api/prove/withdraw', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    note: { secret, nullifier, amount },
    merklePath,
    merkleIndices,
    merkleRoot,
    recipient,
  }),
})

const { proof, publicInputs, timing } = await response.json()
```

## Tech Stack

- **Framework**: Next.js 14+ (App Router)
- **Styling**: Tailwind CSS + shadcn/ui
- **Wallet**: wagmi + viem
- **State**: React Context + hooks
- **SDK**: @anon/sdk for core functionality

## Scripts

```bash
# Development server
bun run dev

# Production build
bun run build

# Start production server
bun run start

# Lint
bun run lint
```

## Architecture Notes

The web app is designed as a thin UI layer that delegates to @anon/sdk:

- **Hooks** wrap SDK functions with React state management
- **Providers** manage global wallet state using SDK utilities
- **API Routes** use SDK for proof generation with native tools
- **Components** focus purely on presentation

This separation keeps the web app lightweight and allows the SDK to be used in other contexts (CLI, mobile, etc.).

## License

MIT
